/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={535:t=>{"use strict";var s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var s={},a=0;a<10;a++)s["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(s).map((function(t){return s[t]})).join(""))return!1;var e={};return"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},e)).join("")}catch(t){return!1}}()?Object.assign:function(t,i){for(var o,n,r=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),l=1;l<arguments.length;l++){for(var m in o=Object(arguments[l]))a.call(o,m)&&(r[m]=o[m]);if(s){n=s(o);for(var d=0;d<n.length;d++)e.call(o,n[d])&&(r[n[d]]=o[n[d]])}}return r}},488:(t,s,a)=>{"use strict";var e=a(535),i="function"==typeof Symbol&&Symbol.for;i&&Symbol.for("react.element"),i&&Symbol.for("react.portal"),i&&Symbol.for("react.fragment"),i&&Symbol.for("react.strict_mode"),i&&Symbol.for("react.profiler"),i&&Symbol.for("react.provider"),i&&Symbol.for("react.context"),i&&Symbol.for("react.forward_ref"),i&&Symbol.for("react.suspense"),i&&Symbol.for("react.memo"),i&&Symbol.for("react.lazy"),"function"==typeof Symbol&&Symbol.iterator;function o(t){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},r={};function l(t,s,a){this.props=t,this.context=s,this.refs=r,this.updater=a||n}function m(){}function d(t,s,a){this.props=t,this.context=s,this.refs=r,this.updater=a||n}l.prototype.isReactComponent={},l.prototype.setState=function(t,s){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error(o(85));this.updater.enqueueSetState(this,t,s,"setState")},l.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},m.prototype=l.prototype;var c=d.prototype=new m;c.constructor=d,e(c,l.prototype),c.isPureReactComponent=!0;Object.prototype.hasOwnProperty},684:(t,s,a)=>{"use strict";a(488)}},s={};function a(e){var i=s[e];if(void 0!==i)return i.exports;var o=s[e]={exports:{}};return t[e](o,o.exports,a),o.exports}a.n=t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return a.d(s,{a:s}),s},a.d=(t,s)=>{for(var e in s)a.o(s,e)&&!a.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:s[e]})},a.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var e={};(()=>{"use strict";a.r(e);const t=flarum.core.compat["admin/app"];var s=a.n(t);function i(t,s){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},i(t,s)}function o(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,i(t,s)}const n=flarum.core.compat["admin/components/ExtensionPage"];var r=a.n(n);const l=flarum.core.compat["common/components/Button"];var d=a.n(l);const c=flarum.core.compat["common/components/Modal"];var p=a.n(c);a(684);const u=flarum.core.compat["components/Modal"];var h=a.n(u);const g=flarum.core.compat["components/Button"];var f=a.n(g);const y=flarum.core.compat["common/utils/Stream"];var b=a.n(y);const v=flarum.core.compat["common/components/Switch"];var x=a.n(v);const N=flarum.core.compat["common/components/Select"];var D=a.n(N),w=function(t){function a(){for(var s,a=arguments.length,e=new Array(a),i=0;i<a;i++)e[i]=arguments[i];return(s=t.call.apply(t,[this].concat(e))||this).method="POST",s.params={status:b()(1),code:b()(),title:b()(),desc:b()(),price:b()(),stock:b()(),discount:b()(),discountLimit:b()(),discountLimitUnit:b()("days"),type:b()("permanent"),outtime:b()(0),icon:b()(),hide:b()(0),repeat:b()(1)},s}o(a,t);var e=a.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.method="POST",this.params.code=b()(this.attrs.code||""),this.params.title=b()(this.attrs.title||""),this.attrs.storeData&&(this.method="PUT",this.params.id=b()(this.attrs.storeData.id),this.params.status=b()(this.attrs.storeData.status),this.params.code=b()(this.attrs.storeData.code),this.params.title=b()(this.attrs.storeData.title),this.params.desc=b()(this.attrs.storeData.desc),this.params.price=b()(this.attrs.storeData.price),this.params.stock=b()(-99==this.attrs.storeData.stock?0:this.attrs.storeData.stock),this.params.discount=b()(this.attrs.storeData.discount),this.params.discountLimit=b()(this.attrs.storeData.discountLimit),this.params.discountLimitUnit=b()(this.attrs.storeData.discountLimitUnit),this.params.type=b()(this.attrs.storeData.type),this.params.outtime=b()(this.attrs.storeData.outtime),this.params.icon=b()(this.attrs.storeData.icon),this.params.hide=b()(this.attrs.storeData.hide),this.params.repeat=b()(this.attrs.storeData.repeat))},e.className=function(){return""},e.title=function(){return this.params.title()},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("div",{style:"text-align: left;"},m("div",{class:"spacing",style:"display: flex; align-items: center;"},m("span",null,s().translator.trans("mattoid-store.admin.settings.goods-status")),m("span",{style:"margin-left: 15px;"},m(x(),{state:this.params.status(),onchange:function(s){t.params.status=b()(Number(s))}}," "))),m("div",{class:"spacing",style:"display: flex; align-items: center;"},m("span",null,s().translator.trans("mattoid-store.admin.settings.goods-code")),m("span",{style:"font-weight: normal; cursor: pointer; border-bottom: 2px dotted; margin-left: 15px;"}," ",this.params.code()," ")),m("div",{class:"spacing",style:"align-items: center;"},m("div",{className:""},s().translator.trans("mattoid-store.admin.settings.goods-title")),m("input",{required:!0,class:"FormControl",type:"text",bidi:this.params.title})),m("div",{class:"spacing",style:"align-items: center;"},m("div",{className:""},s().translator.trans("mattoid-store.admin.settings.goods-desc")),m("textarea",{class:"FormControl",bidi:this.params.desc})),m("div",{className:"spacing"},m("div",{style:"width: 60px; display: inline-block;"},s().translator.trans("mattoid-store.admin.settings.goods-price")),m("input",{required:!0,class:"FormControl",type:"number",step:"1",min:"0",style:"width: 195px; margin-left: 0px; display: inline-block;",bidi:this.params.price}),m("div",{style:"width: 60px; display: inline-block; margin-left: 26px;"},s().translator.trans("mattoid-store.admin.settings.goods-stock")),m("input",{required:!0,class:"FormControl",type:"number",step:"1",min:"0",style:"width: 195px; margin-left: 0px; display: inline-block;",bidi:this.params.stock})),m("div",{className:"spacing"},m("div",{style:"width: 60px; display: inline-block;"},s().translator.trans("mattoid-store.admin.settings.goods-discount")),m("input",{required:!0,class:"FormControl",type:"number",step:"1",min:"0",style:"width: 100px; margin-left: 0px; display: inline-block;",bidi:this.params.discount}),m("div",{style:"width: 60px; display: inline-block; margin-left: 26px;"},s().translator.trans("mattoid-store.admin.settings.goods-discount-limit")),m("input",{required:!0,class:"FormControl",type:"number",step:"1",min:"0",style:"width: 145px; margin-left: 0px; display: inline-block;",bidi:this.params.discountLimit}),m("div",{style:"width: 40px; display: inline-block; margin-left: 26px;"},s().translator.trans("mattoid-store.admin.settings.goods-discount-limit-unit")),D().component({options:{days:s().translator.trans("mattoid-store.lib.item-limit-unit-days"),hour:s().translator.trans("mattoid-store.lib.item-limit-unit-hour"),minute:s().translator.trans("mattoid-store.lib.item-limit-unit-minute"),second:s().translator.trans("mattoid-store.lib.item-limit-unit-second")},value:this.params.discountLimitUnit(),onchange:function(s){t.params.discountLimitUnit=b()(s)}})),m("div",{className:"spacing"},m("div",{style:"width: 60px; display: inline-block;"},s().translator.trans("mattoid-store.admin.settings.goods-type")),D().component({options:{permanent:s().translator.trans("mattoid-store.lib.item-type-permanent"),limit:s().translator.trans("mattoid-store.lib.item-type-limit")},value:this.params.type(),onchange:function(s){t.params.type=b()(s)}}),m("div",{style:"limit"===this.params.type()?"display:inline-block":"display: none"},m("div",{style:"width: 80px; display: inline-block; margin-left: 26px;"},s().translator.trans("mattoid-store.admin.settings.goods-outtime")),m("input",{required:!0,class:"FormControl",type:"number",style:"width: 200px; margin-left: 0px; display: inline-block;",bidi:this.params.outtime}),m("span",{style:"margin-left: 10px;"},"天"))),m("div",{className:"spacing"},m("div",{className:""},s().translator.trans("mattoid-store.admin.settings.goods-icon")),m("div",{style:"position: relative;"},m("div",null,m("input",{id:"icon",required:!0,class:"FormControl",type:"text",bidi:this.params.icon})),m("div",{style:"margin-top: 5px; display: inline-block;"},m(f(),{className:"Button Button--primary",onclick:function(s){t.uploadIcon(s)}},s().translator.trans("mattoid-store.admin.settings.goods-upload-button"))),m("div",{style:"margin-top: 5px; display: inline-block; margin-left: 26px;"},m(f(),{className:"Button Button--primary",onclick:function(t){}},s().translator.trans("mattoid-store.admin.settings.show-icon-button"))))),m("div",{className:"spacing"},m("div",{style:"width: 200px; display: inline-block;"},m(x(),{state:this.params.repeat(),onchange:function(s){t.params.repeat=b()(Number(s))}},s().translator.trans("mattoid-store.admin.settings.goods-repeat"))),m("div",{style:"width: 200px; display: inline-block; margin-left: 26px;"},m(x(),{state:this.params.hide(),onchange:function(s){t.params.hide=b()(Number(s))}},s().translator.trans("mattoid-store.admin.settings.goods-hide"))))),m("div",{className:"spacing center"},f().component({className:"Button Button--primary",type:"submit",loading:this.loading},this.params.id?s().translator.trans("mattoid-store.admin.settings.edit-store-goods"):s().translator.trans("mattoid-store.admin.settings.add-store-goods"))))))},e.uploadIcon=function(t){var a=this;t.preventDefault(),$('<input type="file">').appendTo("body").hide().trigger("click").on("change",(function(t){var e=new FormData;e.append("file",t.target.files[0]),s().request({url:s().forum.attribute("apiUrl")+"/store/upload/icon",method:"POST",body:e}).then((function(t){a.params.icon=b()(t.data.attributes.path),a.loading=!1,m.redraw()}))}))},e.onsubmit=function(t){var a=this;t.preventDefault(),this.loading=!0,s().request({method:this.method,url:s().forum.attribute("apiUrl")+"/store/goods",body:this.params}).then((function(){return location.reload()}),(function(t){a.loading=!1,a.handleErrors(t)}))},a}(h()),k=function(t){function a(){for(var s,a=arguments.length,e=new Array(a),i=0;i<a;i++)e[i]=arguments[i];return(s=t.call.apply(t,[this].concat(e))||this).goodsList=[],s.moreResults=!1,s}o(a,t);var e=a.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.loadResults()},e.title=function(){return s().translator.trans("mattoid-store.admin.settings.add-store-goods")},e.className=function(){return""},e.content=function(){var t=this;return m("div",null,this.goodsList.map((function(t,a){return m("div",{className:"storeItemContainer",style:"margin: 10px"},m("div",{className:"ExtensionPage-body"},m("div",{className:"ExtensionPage-settings FlarumBadgesPage",style:"margin-top: 10px"},m("div",{className:"container"},m("span",{className:"leftAligned",style:"padding: 8px"},t.attributes.name),m(d(),{className:"Button rightAligned",onclick:function(){s().modal.show(w,{code:t.attributes.code,title:t.attributes.name})}},s().translator.trans("mattoid-store.admin.settings.add-store-goods"))))))})),!this.loading&&0===this.goodsList.length&&m("div",null,m("div",{style:"font-size:1.4em;color: var(--muted-more-color);text-align: center;line-height: 100px;"},s().translator.trans("mattoid-store.lib.list-empty"))),!this.loading&&this.hasMoreResults()&&m("div",{style:"text-align:center;padding:20px"},m(d(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return t.loadMore()}},s().translator.trans("mattoid-store.lib.list-load-more"))))},e.hasMoreResults=function(){return this.moreResults},e.loadMore=function(){this.loading=!0,this.loadResults(this.goodsList.length)},e.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.goodsList,t.payload.data),this.loading=!1,m.redraw(),t},e.loadResults=function(t){return void 0===t&&(t=0),s().store.find("/store/goods",{filter:{},page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},a}(p());const S=flarum.core.compat.Component;var O=a.n(S),B=function(t){function a(){return t.apply(this,arguments)||this}o(a,t);var e=a.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.type=this.attrs.title,this.storeData=this.attrs.storeData},e.className=function(){return"Modal--small"},e.title=function(){return s().translator.trans("mattoid-store.admin.settings.goods-item-"+this.type)},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form-group",style:"text-align: center;"},f().component({className:"Button Button--primary",type:"submit",loading:this.loading},s().translator.trans("mattoid-store.lib.confirm"))," ",f().component({className:"Button storeButton--gray",loading:this.loading,onclick:function(){t.hide()}},s().translator.trans("mattoid-store.lib.cancel"))))},e.onsubmit=function(t){var a=this;t.preventDefault(),this.loading=!0;var e=this.storeData.status;this.storeData.status=Number(!this.storeData.status);var i="delete"===this.type?"DELETE":"PUT";s().request({method:i,url:s().forum.attribute("apiUrl")+"/store/goods",body:this.storeData}).then((function(){return location.reload()}),(function(t){a.loading=!1,a.storeData.status=e,a.handleErrors(t)}))},a}(h()),P=function(t){function a(){for(var s,a=arguments.length,e=new Array(a),i=0;i<a;i++)e[i]=arguments[i];return(s=t.call.apply(t,[this].concat(e))||this).storeData={},s}o(a,t);var e=a.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.storeData=this.attrs.item.attributes},e.view=function(){var t=this,a=(s().forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",this.storeData.price),e=this.storeData;return m("div",{id:this.storeData.id,className:"storeItemContainer"},m("div",{className:"leftAligned"},m("div",{className:"margin"},m("span",null,m(f(),{className:"Button Button--primary",onclick:function(){s().modal.show(w,{storeData:e})}},s().translator.trans("mattoid-store.admin.settings.goods-edit"))),m("span",{className:"margin"},m(f(),{className:"Button Button--danger",onclick:function(){s().modal.show(B,{storeData:e,title:"delete"})}},s().translator.trans("mattoid-store.admin.settings.goods-delete"))),m("span",{className:"margin"},m(f(),{className:"Button",onclick:function(){s().modal.show(B,{storeData:e,title:"status-"+t.storeData.status})}},0===this.storeData.status?s().translator.trans("mattoid-store.lib.item-status-1"):s().translator.trans("mattoid-store.lib.item-status-0")))),m("div",null,s().translator.trans("mattoid-store.lib.item-id"),": ",this.storeData.id," |  ",s().translator.trans("mattoid-store.lib.item-title"),": ",this.storeData.title),m("div",null,s().translator.trans("mattoid-store.lib.item-desc"),": ",this.storeData.desc),m("div",null,s().translator.trans("mattoid-store.lib.item-status"),": ",m("span",{className:0===this.storeData.status?"red":"green"},s().translator.trans("mattoid-store.lib.item-status-"+this.storeData.status))," | ",s().translator.trans("mattoid-store.lib.item-price"),": ",a," | ",s().translator.trans("mattoid-store.lib.item-stock"),": ",-99==this.storeData.stock?"无限":this.storeData.stock," | ",s().translator.trans("mattoid-store.lib.item-discount"),": ",this.storeData.discount?this.storeData.discount+" %":"无"," | ",s().translator.trans("mattoid-store.lib.item-discount_limit"),": ",this.storeData.discountLimit||0," ",{days:"天",hour:"小时",minute:"分钟",second:"秒"}[this.storeData.discountLimitUnit]),m("div",null,s().translator.trans("mattoid-store.lib.item-type"),": ",s().translator.trans("mattoid-store.lib.item-type-"+this.storeData.type)," | ",s().translator.trans("mattoid-store.lib.item-created-at"),": ",this.storeData.createdAt)),m("div",{className:"rightAligned icon-size"},m("img",{className:"icon-size",src:this.storeData.icon})))},a}(O()),R=function(t){function a(){for(var s,a=arguments.length,e=new Array(a),i=0;i<a;i++)e[i]=arguments[i];return(s=t.call.apply(t,[this].concat(e))||this).storeList=[],s.moreResults=!1,s}o(a,t);var e=a.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.status=b()("-1"),this.type=b()("-1"),this.loadResults()},e.content=function(){var t=this;return m("div",{className:"ExtensionPage-body"},m("div",{className:"ExtensionPage-settings FlarumBadgesPage"},m("div",{className:"container"},m("form",null,this.buildSettingComponent({type:"string",setting:"mattoid-store.storeName",label:s().translator.trans("mattoid-store.admin.settings.store-name"),placeholder:s().translator.trans("mattoid-store.admin.settings.store-name"),help:s().translator.trans("mattoid-store.admin.settings.store-name-requirement")}),this.buildSettingComponent({type:"string",setting:"mattoid-store.storeTimezone",label:s().translator.trans("mattoid-store.admin.settings.store-timezone"),placeholder:"Asia/Shanghai",help:s().translator.trans("mattoid-store.admin.settings.store-timezone-requirement")}),this.submitButton()),m("hr",null),this.buildSettingComponent((function(){return m(".Form-group",d().component({className:"Button",onclick:function(){s().modal.show(k)}},s().translator.trans("mattoid-store.admin.settings.add-store-goods")))}))),m("div",{className:"container"},m("div",{className:"spacing",style:"overflow: auto"},m("div",{style:"display: inline-block;"},m(D(),{value:this.status(),disabled:this.loading,options:{"-1":s().translator.trans("mattoid-store.lib.item-status-all"),1:s().translator.trans("mattoid-store.lib.item-status-up"),0:s().translator.trans("mattoid-store.lib.item-status-down")},buttonClassName:"Button",onchange:function(s){t.status(s),t.storeList=[],t.loadResults()}})),m("div",{style:" display: inline-block; margin-left: 26px;"},m(D(),{value:this.type(),disabled:this.loading,options:{"-1":s().translator.trans("mattoid-store.lib.item-type-all"),permanent:s().translator.trans("mattoid-store.lib.item-type-permanent"),limit:s().translator.trans("mattoid-store.lib.item-type-limit")},buttonClassName:"Button",onchange:function(s){t.type(s),t.storeList=[],t.loadResults()}}))),m("ul",{style:"padding:0px;list-style-type: none;"},this.storeList.map((function(t){return m("li",{style:"margin-top:5px;background: var(--body-bg);"},P.component({item:t}))}))),!this.loading&&0===this.storeList.length&&m("div",null,m("div",{style:"font-size:1.4em;color: var(--muted-more-color);text-align: center;line-height: 100px;"},s().translator.trans("mattoid-store.lib.list-empty"))),!this.loading&&this.hasMoreResults()&&m("div",{style:"text-align:center;padding:20px"},m(d(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return t.loadMore()}},s().translator.trans("mattoid-store.lib.list-load-more"))))))},e.hasMoreResults=function(){return this.moreResults},e.loadMore=function(){this.loading=!0,this.loadResults(this.storeList.length)},e.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.storeList,t.payload.data),this.loading=!1,m.redraw(),t},e.loadResults=function(t){void 0===t&&(t=0);var a={type:this.type(),status:this.status()};return s().store.find("/store/list",{filter:a,page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},a}(r());s().initializers.add("mattoid-store",(function(){s().extensionData.for("mattoid-store").registerPage(R).registerPermission({icon:"fas fa-id-card",label:s().translator.trans("mattoid-store.admin.settings.group-view"),permission:"mattoid-store.group-view",allowGuest:!0},"view").registerPermission({icon:"fas fa-id-card",label:s().translator.trans("mattoid-store.admin.settings.group-view"),permission:"mattoid-store.group-moderate",allowGuest:!0},"moderate")}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map